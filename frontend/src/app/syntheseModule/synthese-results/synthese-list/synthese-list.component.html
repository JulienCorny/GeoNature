<!-- <table>
    <tr *ngFor="let item of inputSyntheseData?.features" [ngClass]=" {'selected': mapListService.selectedRow[0]?.id_synthese == item.properties.id_synthese }">
        <td class="button" (click)="mapListService.onRowSelect(item.properties.id_synthese)">onmap</td>
        <td>{{item.properties.date_min}}</td>
        <td>{{item.properties.date_max}}</td>
        <td>{{item.properties.observers}}</td>
        <td>{{item.properties.nom_cite}}</td>
        <td>{{item.id}}</td>
        <td> {{mapListService.selectedRow[0]?.id_synthese == item.properties.id_synthese}} </td>
        <td>min : {{item.properties.count_min}} max : {{item.properties.count_max}}</td>
    </tr>
</table> -->

<!--Table-->
<ngx-datatable (window:resize)="onResize($event)" #table class="material striped margin-top-xs table-size expandable" [rows]="mapListService.tableData"
  [columns]="SYNTHESE_CONFIG.LIST_COLUMNS" [columnMode]="'force'" [loadingIndicator]="!_ds.dataLoaded" [headerHeight]="50"
  [footerHeight]="35" [rowHeight]="50" [selected]="mapListService.selectedRow" [selectionType]="'single'" [count]="mapListService.tableData.length"
  [limit]="rowNumber" [rowClass]="mapListService.getRowClass" [rowHeight]="'auto'" (select)="mapListService.onRowSelect($event)">


  <ngx-datatable-row-detail rowHeight="100" #myDetailRow (toggle)="loadOneSyntheseReleve($event)">
    <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
      <div style="padding-left:35px;">
        <div>
          <small>
            <b> Altitude </b>: entre {{row.atltude_min}}m - {{row.altitude_max}}m
            <br/>
            <b> Méthode d'observation: </b> {{selectedObs?.obs_method}}
            <b> Stade de vie: </b> {{selectedObs?.life_stage}}
            <br/>
            <b> Denombrement </b> Entre {{row.count_min}}/{{row.count_min}} individu de sexe: {{selectedObs?.sex}}
            <br/> Stade de vie : {{ selectedObs?.bio_condition}}
            <br/>
          </small>
        </div>
      </div>
    </ng-template>
  </ngx-datatable-row-detail>

  <ngx-datatable-column [width]="10" [resizeable]="false" [sortable]="false" [draggable]="false" [canAutoResize]="false">
    <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
      <a href="javascript:void(0)" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded" title="Expand/Collapse Row"
        (click)="toggleExpandRow(row)">
      </a>
    </ng-template>
  </ngx-datatable-column>

  <!-- ACTION COLUMNS -->
  <!-- <ngx-datatable-column maxWidth="10">
    <ng-template let-row="row" ngx-datatable-cell-template>
      <button class="btn btn-secondary btn-no-padding btn-ghost" [disabled]="!row.cruved.U" (click)="onEditReleve(row.url_source, row.entity_source_pk_value)">
        <i [ngClass]="{'disabled' : !row.cruved.U}" matTooltip="{{'Releve.Edit' | translate}} {{row[mapListService.idName]}}" class="fa fa-pencil-square-o"
          aria-hidden="true"></i>
      </button>
    </ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column maxWidth="10">
    <ng-template let-row="row" ngx-datatable-cell-template>
      <button class="btn btn-secondary btn-no-padding btn-ghost" [disabled]="!row.cruved.D" (click)="openDeleteModal($event, modalConfirm, iElement, row)">
        <i [ngClass]="{'disabled' : !row.cruved.D}" #iElement matTooltip="{{ 'Releve.Delete' | translate }} {{row[mapListService.idName]}}"
          class="fa fa-trash-o" aria-hidden="true"></i>
      </button>
    </ng-template>
  </ngx-datatable-column> -->

  <ngx-datatable-column maxWidth="10">
    <ng-template let-row="row" ngx-datatable-cell-template>
      <button class="btn btn-secondary btn-no-padding btn-ghost" (click)="openInfoModal(modalInfoObs, row);">
        <i #iElement matTooltip="{{row[mapListService.idName]}}" class="fa fa-info-circle" " aria-hidden="true "></i>
      </button>
    </ng-template>
  </ngx-datatable-column> -->


  <!-- DATA COLOMNS -->
  <ngx-datatable-column *ngFor="let col of SYNTHESE_CONFIG.LIST_COLUMNS " [name]="col.name " [prop]="col.prop ">
  </ngx-datatable-column>
</ngx-datatable>



<ng-template #modalConfirm let-c="close " let-d="dismiss ">
  <div class="modal-header ">
    <h5 class="modal-title " id="exampleModalLabel "> {{'Releve.Delete' | translate }} {{ mapListService.selectedRow[0][mapListService.idName]}}
      ?
    </h5>
  </div>
  <div class="modal-body ">
    <button type="button " class="btn btn-default " (click)="c() "> {{'Cancel' | translate}} </button>
    <button type="button " class="btn btn-danger " (click)="c(); onDeleteObservation(mapListService.selectedRow[0].id_synthese) ">
      {{'Delete' | translate }} </button>
  </div>
</ng-template>

<pnx-modal-download [pathDownload]="exportRoute " [queryString]="queyrStringDownload " [exportFormat]="SYNTHESE_CONFIG.EXPORT_FORMAT "
  (buttonClicked)="setQueryString() ">

</pnx-modal-download>

<!-- MODAL INFO OBS -->
<ng-template #modalInfoObs let-c="close " let-d="dismiss ">
  <div class="modal-body ">
    <h5 class="underlined main-color "> Information observation </h5>
    <div class="card " style="margin:0px; margin-bottom:10px; ">
      <div class="card-block padding-md-all ">
        <div class="row row-sm ">
          <div class="padding-sm col-xs-5 col-sm-5 col-md-5 col-lg-5 ">
            <h5>
              <a target="_blank " href="https://inpn.mnhn.fr/espece/cd_nom/{{ selectedObs?.taxon?.cd_nom }} "> {{ selectedObs?.taxon?.nom_vern
                }} - {{ selectedObs?.taxon?.nom_valide }}</a>
            </h5>
            <span class="font-xs ">
              <b> Observation de: </b> {{selectedObs?.observers}}
              <br>
              <b> Date: </b>{{selectedObs?.date_min}} -> {{selectedObs?.date_max}}
              <br>
              <b> Commune(s) </b>: {{selectedObs?.nom_com}}
              <b> Altitude</b>: {{selectedObs?.altitude_min}} m - {{selectedObs?.altitude_max}} m
            </span>
          </div>

          <div *ngIf="selectedObs?.areas> 0" class=" padding-sm col-xs-4 col-sm-4 col-md-4 col-lg-4">
          <b> Autres espaces concernés par l'observation</b>
          <li *ngFor="let area of selectedObs?.areas"> {{area.area_name}} </li>
          </div>
          </div>

          </div>
          </div>


          <div class="row">
            <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
              <h5 class="underlined main-color"> Détail de l'occurrence </h5>
              <table class="font-xs table table-striped table-sm">
                <tr>
                  <td> Stade de vie: </td>
                  <td> {{selectedObs?.life_stage}} </td>
                </tr>
                <tr>
                  <td> Technique d'observation </td>
                  <td> {{selectedObs?.obs_technique}} </td>
                </tr>

                <tr>
                  <td> Niveau de diffusion </td>
                  <td> {{selectedObs?.diffusion_level}} </td>
                </tr>

                <tr>
                  <td> Preuve d'existance </td>
                  <td> {{selectedObs?.exist_proof}} </td>
                </tr>

                <tr>
                  <td> Méthode d'observation </td>
                  <td> {{selectedObs?.obs_method}} </td>
                </tr>
                <tr>
                  <td> Denombrement min </td>
                  <td> {{selectedObs?.count_min}} </td>
                </tr>
                <tr>
                  <td> Denombrement min </td>
                  <td> {{selectedObs?.count_max}} </td>
                </tr>
                <tr>
                  <td> Type de dénombrement </td>
                  <td> {{selectedObs?.type_count}} </td>
                </tr>

                <tr>
                  <td> Nature de l'objet géographique </td>
                  <td> {{selectedObs?.nat_obj_geo}} </td>
                </tr>

                <tr>
                  <td> Statut biologique </td>
                  <td> {{selectedObs?.bio_status}} </td>
                </tr>

                <tr>
                  <td> Sensibilité </td>
                  <td> {{selectedObs?.sensitivity}} </td>
                </tr>

                <tr>
                  <td> Stade de vie </td>
                  <td> {{selectedObs?.life_stage}} </td>
                </tr>

                <tr>
                  <td> Type de regroupement </td>
                  <td> {{selectedObs?.grp_typ}} </td>
                </tr>

                <tr>
                  <td> Naturalité </td>
                  <td> {{selectedObs?.naturalness}} </td>
                </tr>

                <tr>
                  <td> Objet du dénombrement </td>
                  <td> {{selectedObs?.obj_count}} </td>
                </tr>

                <tr>
                  <td> Statut de l'observation </td>
                  <td> {{selectedObs?.observation_status}} </td>
                </tr>

                <tr>
                  <td> Sexe </td>
                  <td> {{selectedObs?.sex}} </td>
                </tr>

                <tr>
                  <td> Source de la donnée </td>
                  <td> {{selectedObs?.source_status}} </td>
                </tr>

                <tr>
                  <td> Statut de validation </td>
                  <td> {{selectedObs?.valid_status}} </td>
                </tr>

                <tr>
                  <td> Floutage </td>
                  <td> {{selectedObs?.valid_status}} </td>
                </tr>

                <tr>
                  <td> Condition biologique </td>
                  <td> {{selectedObs?.bio_condition}} </td>
                </tr>
              </table>

            </div>


            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">

              <h5 class="underlined main-color"> Taxonomie </h5>

              <table class="size-xs table table-striped table-sm">

                <tr>
                  <td>
                    <b>Groupe taxonomique </b>
                  </td>
                  <td> {{ selectedObs?.taxon?.classe }} </td>
                </tr>
                <tr>
                  <td>
                    <b>Ordre</b>
                  </td>
                  <td> {{ selectedObs?.taxon?.ordre }} </td>
                </tr>
                <tr>
                  <td>
                    <b> Famille</b>
                  </td>
                  <td> {{ selectedObs?.taxon?.famille }} </td>
                </tr>

                <!-- TODO -->
                <!-- Attribut Taxhub -->

              </table>

              <h5 class="underlined main-color"> Réglementation</h5>
              <table class="font-xs table table-striped table-sm">

                <tr *ngFor="let arrete of selectedObs?.taxon?.statuts_protection">
                  <td>
                    <a [href]="arrete.url"> {{arrete.intitule}} </a>
                  </td>
                </tr>
              </table>

              <!-- <object [data]="sanitizer.bypassSecurityTrustResourceUrl(inpnMapUrl)" type="image/svg+xml" width="90%" height="90%">
          <param name="src" value="/cartosvg/couchegeo/repartition/atlas/{{selectedObs?.cd_nom}}/fr_light_l93,fr_light_mer_l93,fr_lit_l93">
          <param name="type" value="image/svg+xml">
          <param name="pluginspage" value="http://www.adobe.com/svg/viewer/install/">
        </object> -->

            </div>


          </div>

          </div>
    </ng-template>


    <button (click)="downloadData('shapefile')"> export </button>
